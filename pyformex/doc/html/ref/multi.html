

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- 
##
##  This file is part of the pyFormex project.
##  pyFormex is a tool for generating, manipulating and transforming 3D
##  geometrical models by sequences of mathematical operations.
##  Home page: http://pyformex.org
##  Project page:  http://savannah.nongnu.org/projects/pyformex/
##  Copyright (C) Benedict Verhegghe (benedict.verhegghe@ugent.be) 
##  Distributed under the GNU General Public License version 3 or later.
##
##
##  This program is free software: you can redistribute it and/or modify
##  it under the terms of the GNU General Public License as published by
##  the Free Software Foundation, either version 3 of the License, or
##  (at your option) any later version.
##
##  This program is distributed in the hope that it will be useful,
##  but WITHOUT ANY WARRANTY; without even the implied warranty of
##  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
##  GNU General Public License for more details.
##
##  You should have received a copy of the GNU General Public License
##  along with this program.  If not, see http://www.gnu.org/licenses/.
##
-->


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>23. multi — Framework for multi-processing in pyFormex &mdash; pyFormex 1.0.2-a6 documentation</title>

    
    <link rel="stylesheet" href="../_static/pyformex.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.2-a6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="pyFormex 1.0.2-a6 documentation" href="../index.html" />
    <link rel="up" title="pyFormex reference manual" href="../refman.html" />
    <link rel="next" title="24. software — software.py" href="software.html" />
    <link rel="prev" title="22. field — Field data in pyFormex." href="field.html" />
<link rel="icon" type="image/png" href="_static/pyformex_fav.png" />

  </head>
  <body role="document">

<div class="header">
  <a href="http://pyformex.org">
  <img src="http://www.nongnu.org/pyformex/_static/scallop_dome_small.png" alt="scallop dome" border="0" hspace="20" vspace="12" align="left" />
  <img src="http://www.nongnu.org/pyformex/_static/pyformex-logo-2.png" alt="pyformex logo" border="0" hspace="10" vspace="8" align="left" />
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="software.html" title="24. software — software.py"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="field.html" title="22. field — Field data in pyFormex."
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyFormex 1.0.2-a6 documentation</a> &gt;</li>
          <li class="nav-item nav-item-1"><a href="../refman.html" accesskey="U">pyFormex reference manual</a> &gt;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div align="center">

<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
<input type="hidden" name="cmd" value="_s-xclick"/>
<input type="hidden" name="hosted_button_id" value="P7J4AM4QULB4Q"/>
<input type="image" src="https://www.paypal.com/en_US/BE/i/btn/btn_donateCC_LG.gif" name="submit" alt="PayPal - The safer, easier way to pay online!"/>
<img alt="" border="0" src="https://www.paypal.com/nl_NL/i/scr/pixel.gif" width="1" height="1"/>
</form>

</div>
   
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">23. <code class="docutils literal"><span class="pre">multi</span></code> &#8212; Framework for multi-processing in pyFormex</a><ul>
<li><a class="reference internal" href="#classes-defined-in-module-multi">23.1. Classes defined in module multi</a></li>
<li><a class="reference internal" href="#functions-defined-in-module-multi">23.2. Functions defined in module multi</a></li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="field.html"
                        title="previous chapter">22. <code class="docutils literal"><span class="pre">field</span></code> &#8212; Field data in pyFormex.</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="software.html"
                        title="next chapter">24. <code class="docutils literal"><span class="pre">software</span></code> &#8212; software.py</a></p>
  
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>

<div align="center">
  <p>
  <a href="http://www.fsf.org/register_form?referrer=8491"><img src="http://www.nongnu.org/pyformex/_static/fsf-member8491.png" alt="[FSF Associate Member]" width="89" height="31"  /></a>
  </p>
  <p>
    <a href="http://validator.w3.org/check?uri=referer"><img
      src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0 Transitional" height="31" width="88" /></a>
  </p>
</div>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-multi">
<span id="multi-framework-for-multi-processing-in-pyformex"></span><span id="sec-ref-multi"></span><h1>23. <a class="reference internal" href="#module-multi" title="multi: Framework for multi-processing in pyFormex"><code class="xref py py-mod docutils literal"><span class="pre">multi</span></code></a> &#8212; Framework for multi-processing in pyFormex<a class="headerlink" href="#module-multi" title="Permalink to this headline">¶</a></h1>
<p>This module contains some functions to perform multiprocessing inside
pyFormex in a unified way.</p>
<div class="section" id="classes-defined-in-module-multi">
<h2>23.1. Classes defined in module multi<a class="headerlink" href="#classes-defined-in-module-multi" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="functions-defined-in-module-multi">
<h2>23.2. Functions defined in module multi<a class="headerlink" href="#functions-defined-in-module-multi" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="multi.splitArgs">
<code class="descclassname">multi.</code><code class="descname">splitArgs</code><span class="sig-paren">(</span><em>args</em>, <em>mask=None</em>, <em>nproc=-1</em>, <em>close=False</em><span class="sig-paren">)</span><a class="headerlink" href="#multi.splitArgs" title="Permalink to this definition">¶</a></dt>
<dd><p>Split data blocks over multiple processors.</p>
<p>Parameters:</p>
<ul class="simple">
<li><cite>args</cite>: a list or tuple of data blocks. All items in the list
that need to be split should be arrays with the same first dimension.</li>
<li><cite>mask</cite>: list of bool, with same length as <cite>args</cite>. It flags which
items in the <cite>args</cite> list are to be split. If not specified,
all array type items will be split.</li>
<li><cite>nproc</cite>: number of processors intended. If negative (default),
it is set equal to the number of processors detected.</li>
<li><cite>close</cite>: bool. If True, the elements where the arrays are
split are included in both blocks delimited by the element.</li>
</ul>
<p>Returns a list of <cite>nproc</cite> tuples. Each tuple contains the same
number of items as the input <cite>args</cite> and in the same order, whereby
the (nonmasked) arrays are replaced by a slice of the array along
its first axis, and the masked and non-array items are replicated
as is.</p>
<p>This function uses <a class="reference internal" href="arraytools.html#arraytools.splitar" title="arraytools.splitar"><code class="xref py py-meth docutils literal"><span class="pre">arraytools.splitar()</span></code></a> for the splitting
of the arrays.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">splitArgs</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="s1">&#39;abcde&#39;</span><span class="p">],</span><span class="n">nproc</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="go">[(array([0, 1]), &#39;abcde&#39;), (array([2]), &#39;abcde&#39;), (array([3, 4]), &#39;abcde&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">splitArgs</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="s1">&#39;=&gt;&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)],</span><span class="n">nproc</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<span class="go">[[ 1.  0.  0.  0.  0.]</span>
<span class="go"> [ 0.  1.  0.  0.  0.]] =&gt; [0 1]</span>
<span class="go">[[ 0.  0.  1.  0.  0.]] =&gt; [2]</span>
<span class="go">[[ 0.  0.  0.  1.  0.]</span>
<span class="go"> [ 0.  0.  0.  0.  1.]] =&gt; [3 4]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">splitArgs</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="s1">&#39;=&gt;&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)],</span><span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">nproc</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<span class="go">[[ 1.  0.  0.  0.  0.]</span>
<span class="go"> [ 0.  1.  0.  0.  0.]] =&gt; [0 1 2 3 4]</span>
<span class="go">[[ 0.  0.  1.  0.  0.]] =&gt; [0 1 2 3 4]</span>
<span class="go">[[ 0.  0.  0.  1.  0.]</span>
<span class="go"> [ 0.  0.  0.  0.  1.]] =&gt; [0 1 2 3 4]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="multi.dofunc">
<code class="descclassname">multi.</code><code class="descname">dofunc</code><span class="sig-paren">(</span><em>arg</em><span class="sig-paren">)</span><a class="headerlink" href="#multi.dofunc" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function for the multitask function.</p>
<p>It expects a tuple with (function,args) as single argument.</p>
</dd></dl>

<dl class="function">
<dt id="multi.multitask">
<code class="descclassname">multi.</code><code class="descname">multitask</code><span class="sig-paren">(</span><em>tasks</em>, <em>nproc=-1</em><span class="sig-paren">)</span><a class="headerlink" href="#multi.multitask" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform tasks in parallel.</p>
<p>Runs a number of tasks in parallel over a number of subprocesses.</p>
<p>Parameters:</p>
<ul class="simple">
<li><cite>tasks</cite> : a list of (function,args) tuples, where function is a
callable and args is a tuple with the arguments to be passed to the
function.</li>
<li>` nproc`: the number of subprocesses to be started. This may be
different from the number of tasks to run: processes finishing a
task will pick up a next one. There is no benefit in starting more
processes than the number of tasks or the number of processing units
available. The default will set <cite>nproc</cite> to the minimum of these two
values.</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="multi.worker">
<code class="descclassname">multi.</code><code class="descname">worker</code><span class="sig-paren">(</span><em>input</em>, <em>output</em><span class="sig-paren">)</span><a class="headerlink" href="#multi.worker" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function for the multitask function.</p>
<p>This is the function executed by any of the processes started
by the multitask function. It takes tuples (function,args) from
the input queue, computes the results of the call function(args),
and pushes these results on the output queue.</p>
<p>Parameters:</p>
<ul class="simple">
<li><cite>input</cite>: Queue holding the tasks to be performed</li>
<li><cite>output</cite>: Queue where the results are to be delivered</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="multi.multitask2">
<code class="descclassname">multi.</code><code class="descname">multitask2</code><span class="sig-paren">(</span><em>tasks</em>, <em>nproc=-1</em><span class="sig-paren">)</span><a class="headerlink" href="#multi.multitask2" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform tasks in parallel.</p>
<p>Runs a number of tasks in parallel over a number of subprocesses.</p>
<p>Parameters:</p>
<ul class="simple">
<li><cite>tasks</cite> : a list of (function,args) tuples, where function is a
callable and args is a tuple with the arguments to be passed to the
function.</li>
<li>` nproc`: the number of subprocesses to be started. This may be
different from the number of tasks to run: processes finishing a
task will pick up a next one. There is no benefit in starting more
processes than the number of tasks or the number of processing units
available. The default will set <cite>nproc</cite> to the minimum of these two
values.</li>
</ul>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="software.html" title="24. software — software.py"
             >next</a> |</li>
        <li class="right" >
          <a href="field.html" title="22. field — Field data in pyFormex."
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyFormex 1.0.2-a6 documentation</a> &gt;</li>
          <li class="nav-item nav-item-1"><a href="../refman.html" >pyFormex reference manual</a> &gt;</li> 
      </ul>
    </div>
    <div class="footer">
    <span class="left">
        &copy; Copyright 2004-2015, Benedict Verhegghe.
    </span>
      Last updated on Sep 08, 2016.
    <span class="right">
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.5.
    </span>
    </div>
  </body>
</html>