

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- 
##
##  This file is part of the pyFormex project.
##  pyFormex is a tool for generating, manipulating and transforming 3D
##  geometrical models by sequences of mathematical operations.
##  Home page: http://pyformex.org
##  Project page:  http://savannah.nongnu.org/projects/pyformex/
##  Copyright (C) Benedict Verhegghe (benedict.verhegghe@ugent.be) 
##  Distributed under the GNU General Public License version 3 or later.
##
##
##  This program is free software: you can redistribute it and/or modify
##  it under the terms of the GNU General Public License as published by
##  the Free Software Foundation, either version 3 of the License, or
##  (at your option) any later version.
##
##  This program is distributed in the hope that it will be useful,
##  but WITHOUT ANY WARRANTY; without even the implied warranty of
##  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
##  GNU General Public License for more details.
##
##  You should have received a copy of the GNU General Public License
##  along with this program.  If not, see http://www.gnu.org/licenses/.
##
-->


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>87. flatkeydb — Flat Text File Database. &mdash; pyFormex 1.0.2-a6 documentation</title>

    
    <link rel="stylesheet" href="../_static/pyformex.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.2-a6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="pyFormex 1.0.2-a6 documentation" href="../index.html" />
    <link rel="up" title="pyFormex reference manual" href="../refman.html" />
    <link rel="next" title="88. sendmail — sendmail.py: a simple program to send an email message" href="sendmail.html" />
    <link rel="prev" title="86. config — A general yet simple configuration class." href="config.html" />
<link rel="icon" type="image/png" href="_static/pyformex_fav.png" />

  </head>
  <body role="document">

<div class="header">
  <a href="http://pyformex.org">
  <img src="http://www.nongnu.org/pyformex/_static/scallop_dome_small.png" alt="scallop dome" border="0" hspace="20" vspace="12" align="left" />
  <img src="http://www.nongnu.org/pyformex/_static/pyformex-logo-2.png" alt="pyformex logo" border="0" hspace="10" vspace="8" align="left" />
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="sendmail.html" title="88. sendmail — sendmail.py: a simple program to send an email message"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="config.html" title="86. config — A general yet simple configuration class."
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyFormex 1.0.2-a6 documentation</a> &gt;</li>
          <li class="nav-item nav-item-1"><a href="../refman.html" accesskey="U">pyFormex reference manual</a> &gt;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div align="center">

<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
<input type="hidden" name="cmd" value="_s-xclick"/>
<input type="hidden" name="hosted_button_id" value="P7J4AM4QULB4Q"/>
<input type="image" src="https://www.paypal.com/en_US/BE/i/btn/btn_donateCC_LG.gif" name="submit" alt="PayPal - The safer, easier way to pay online!"/>
<img alt="" border="0" src="https://www.paypal.com/nl_NL/i/scr/pixel.gif" width="1" height="1"/>
</form>

</div>
   
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">87. <code class="docutils literal"><span class="pre">flatkeydb</span></code> &#8212; Flat Text File Database.</a><ul>
<li><a class="reference internal" href="#classes-defined-in-module-flatkeydb">87.1. Classes defined in module flatkeydb</a></li>
<li><a class="reference internal" href="#functions-defined-in-module-flatkeydb">87.2. Functions defined in module flatkeydb</a></li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="config.html"
                        title="previous chapter">86. <code class="docutils literal"><span class="pre">config</span></code> &#8212; A general yet simple configuration class.</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="sendmail.html"
                        title="next chapter">88. <code class="docutils literal"><span class="pre">sendmail</span></code> &#8212; sendmail.py: a simple program to send an email message</a></p>
  
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>

<div align="center">
  <p>
  <a href="http://www.fsf.org/register_form?referrer=8491"><img src="http://www.nongnu.org/pyformex/_static/fsf-member8491.png" alt="[FSF Associate Member]" width="89" height="31"  /></a>
  </p>
  <p>
    <a href="http://validator.w3.org/check?uri=referer"><img
      src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0 Transitional" height="31" width="88" /></a>
  </p>
</div>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-flatkeydb">
<span id="flatkeydb-flat-text-file-database"></span><span id="sec-ref-flatkeydb"></span><h1>87. <a class="reference internal" href="#module-flatkeydb" title="flatkeydb: Flat Text File Database."><code class="xref py py-mod docutils literal"><span class="pre">flatkeydb</span></code></a> &#8212; Flat Text File Database.<a class="headerlink" href="#module-flatkeydb" title="Permalink to this headline">¶</a></h1>
<p>A simple database stored as a flat text file.</p>
<div class="line-block">
<div class="line">(C) 2005 Benedict Verhegghe.</div>
<div class="line">Distributed under the GNU GPL version 3 or later.</div>
</div>
<div class="section" id="classes-defined-in-module-flatkeydb">
<h2>87.1. Classes defined in module flatkeydb<a class="headerlink" href="#classes-defined-in-module-flatkeydb" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="flatkeydb.FlatDB">
<em class="property">class </em><code class="descclassname">flatkeydb.</code><code class="descname">FlatDB</code><span class="sig-paren">(</span><em>req_keys=[]</em>, <em>comment='#'</em>, <em>key_sep='='</em>, <em>beginrec='beginrec'</em>, <em>endrec='endrec'</em>, <em>strip_blanks=True</em>, <em>strip_quotes=True</em>, <em>check_func=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.FlatDB" title="Permalink to this definition">¶</a></dt>
<dd><p>A database stored as a dictionary of dictionaries.</p>
<p>Each record is a dictionary where keys and values are just strings.
The field names (keys) can be different for each record, but there is at
least one field that exists for all records and will be used as the
primary key. This field should have unique values for all records.</p>
<p>The database itself is also a dictionary, with the value of the primary
key as key and the full record as value.</p>
<p>On constructing the database a list of keys must be specified that will be
required for each record. The first key in this list will be used as the
primary key. Obviously, the list must at least have one required key.</p>
<p>The database is stored in a flat text file. Each field (key,value pair)
is put on a line by itself. Records are delimited by a (beginrec,
endrec) pair. The beginrec marker can be followed by a (key,value) pair
on the same line. The endrec marker should be on a line by itself.
If endrec is an empty string, each occurrence of beginrec will implicitly
end the previous record.</p>
<p>Lines starting with the comment string are ignored. They can occur anywhere
between or inside records. Blank lines are also ignored (except they serve
as record delimiter if endrec is empty)</p>
<p>Thus, with the initialization:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">FlatDB</span><span class="p">(</span><span class="n">req_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">],</span> <span class="n">comment</span> <span class="o">=</span> <span class="s1">&#39;com&#39;</span><span class="p">,</span> <span class="n">key_sep</span> <span class="o">=</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span>
<span class="n">beginrec</span> <span class="o">=</span> <span class="s1">&#39;rec&#39;</span><span class="p">,</span> <span class="n">endrec</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>the following is a legal database:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">com</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">comment</span>
<span class="n">com</span>
<span class="n">rec</span> <span class="n">key1</span><span class="o">=</span><span class="n">val1</span>
   <span class="n">key2</span><span class="o">=</span><span class="n">val2</span>
<span class="n">rec</span>
<span class="n">com</span> <span class="n">Yes</span><span class="p">,</span> <span class="n">this</span> <span class="n">starts</span> <span class="n">another</span> <span class="n">record</span>
   <span class="n">key1</span><span class="o">=</span><span class="n">val3</span>
   <span class="n">key3</span><span class="o">=</span><span class="n">val4</span>
</pre></div>
</div>
<p>The <cite>readFile</cite> function can even be instructed to ignore anything not
between a (beginrec,endrec) pair. This allows for multiple databases
being stored on the same file, even with records intermixed.</p>
<p>Keys and values can be any strings, except that a key can not begin nor
end with a blank, and can not be equal to any of the comment, beginrec
or endrec markers.
Whitespace around the key is always stripped. By default, this is also
done for the value (though this can be switched off.)
If strip_quotes is True (default), a single pair of matching quotes
surrounding the value will be stripped off. Whitespace is stripped
before stripping the quotes, so that by including the value in quotes,
you can keep leading and trailing whitespace in the value.</p>
<p>A record checking function can be specified. It takes a record as its
argument. It is called whenever a new record is inserted in the database
(or an existing one is replaced). Before calling this <code class="docutils literal"><span class="pre">check_func</span></code>, the
system will already have checked that the record is a dictionary and
that it has all the required keys.</p>
<p>Two error handlers may be overridden by the user:</p>
<ul class="simple">
<li>record_error_handler(record) is called when the record does not pass the
checks;</li>
<li>key_error_handler(key) is called when a dunplicat key is encountered.</li>
</ul>
<p>The default for both is to raise an error.
Overriding is done by changing the instance attibute.</p>
<dl class="method">
<dt id="flatkeydb.FlatDB.newRecord">
<code class="descname">newRecord</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.FlatDB.newRecord" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a new (empty) record.</p>
<p>The new record is a temporary storage. It should be added to the
database by calling append(record).
This method can be overriden in subclasses.</p>
</dd></dl>

<dl class="method">
<dt id="flatkeydb.FlatDB.checkKeys">
<code class="descname">checkKeys</code><span class="sig-paren">(</span><em>record</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.FlatDB.checkKeys" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that record has the required keys.</p>
</dd></dl>

<dl class="method">
<dt id="flatkeydb.FlatDB.checkRecord">
<code class="descname">checkRecord</code><span class="sig-paren">(</span><em>record</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.FlatDB.checkRecord" title="Permalink to this definition">¶</a></dt>
<dd><p>Check a record.</p>
<p>This function checks that the record is a dictionary type, that the
record has the required keys, and that check_func(record) returns
True (if a <cite>check_func</cite> was specified).
If the record passes, just return True. If it does not, call the
<cite>record_error_handler</cite> and (if it returns) return False.
This method can safely be overriden in subclasses.</p>
</dd></dl>

<dl class="method">
<dt id="flatkeydb.FlatDB.record_error_handler">
<code class="descname">record_error_handler</code><span class="sig-paren">(</span><em>record</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.FlatDB.record_error_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Error handler called when a check error on record is discovered.</p>
<p>Default is to raise a runtime error.
This method can safely be overriden in subclasses.</p>
</dd></dl>

<dl class="method">
<dt id="flatkeydb.FlatDB.key_error_handler">
<code class="descname">key_error_handler</code><span class="sig-paren">(</span><em>key</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.FlatDB.key_error_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Error handler called when a duplicate key is found.</p>
<p>Default is to raise a runtime error.
This method can safely be overriden in subclasses.</p>
</dd></dl>

<dl class="method">
<dt id="flatkeydb.FlatDB.insert">
<code class="descname">insert</code><span class="sig-paren">(</span><em>record</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.FlatDB.insert" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert a record to the database, overwriting existing records.</p>
<p>This is equivalent to <cite>__setitem__</cite> but using the value stored in the
the primary key field of the record as key for storing the record.
This is also similar to append(), but overwriting an old record with
the same primary key.</p>
</dd></dl>

<dl class="method">
<dt id="flatkeydb.FlatDB.append">
<code class="descname">append</code><span class="sig-paren">(</span><em>record</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.FlatDB.append" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a record to the database.</p>
<p>Since the database is a dictionary, keys are unique and appending a
record with an existing key is not allowed.
If you want to overwrite the old record, use insert() instead.</p>
</dd></dl>

<dl class="method">
<dt id="flatkeydb.FlatDB.splitKeyValue">
<code class="descname">splitKeyValue</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.FlatDB.splitKeyValue" title="Permalink to this definition">¶</a></dt>
<dd><p>Split a line in key,value pair.</p>
<p>The field is split on the first occurrence of the <cite>key_sep</cite>.
Key and value are then stripped of leading and trailing whitespace.
If there is no key_sep, the whole line becomes the key and the
value is an empty string. If the key_sep is the first character,
the key becomes an empty string.</p>
</dd></dl>

<dl class="method">
<dt id="flatkeydb.FlatDB.parseLine">
<code class="descname">parseLine</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.FlatDB.parseLine" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse a line of the flat database file.</p>
<p>A line starting with the comment string is ignored.
Leading whitespace on the remaining lines is ignored.
Empty (blank) lines are ignored, unless the ENDREC mark was set
to an empty string, in which case they count as an end of record
if a record was started.
Lines starting with a &#8216;BEGINREC&#8217; mark start a new record. The
remainder of the line is then reparsed.
Lines starting with an &#8216;ENDREC&#8217; mark close and store the record.
All lines between the BEGINREC and ENDREC should be field definition
lines of the type &#8216;KEY [ = VALUE ]&#8217;.
This function returns 0 if the line was parsed correctly.
Else, the variable self.error_msg is set.</p>
</dd></dl>

<dl class="method">
<dt id="flatkeydb.FlatDB.parse">
<code class="descname">parse</code><span class="sig-paren">(</span><em>lines</em>, <em>ignore=False</em>, <em>filename=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.FlatDB.parse" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a database from text.</p>
<p>lines is an iterater over text lines (e.g. a text file or a
multiline string splitted on &#8216;n&#8217;)
Lines starting with a comment string are ignored.
Every record is delimited by a (beginrec,endrec) pair.
If ignore is True, all lines that are not between a (beginrec,endrec)
pair are simply ignored. Default is to raise a RuntimeError.</p>
</dd></dl>

<dl class="method">
<dt id="flatkeydb.FlatDB.readFile">
<code class="descname">readFile</code><span class="sig-paren">(</span><em>filename</em>, <em>ignore=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.FlatDB.readFile" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a database from file.</p>
<p>Lines starting with a comment string are ignored.
Every record is delimited by a (beginrec,endrec) pair.
If ignore is True, all lines that are not between a (beginrec,endrec)
pair are simply ignored. Default is to raise a RuntimeError.</p>
</dd></dl>

<dl class="method">
<dt id="flatkeydb.FlatDB.writeFile">
<code class="descname">writeFile</code><span class="sig-paren">(</span><em>filename</em>, <em>mode='w'</em>, <em>header=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.FlatDB.writeFile" title="Permalink to this definition">¶</a></dt>
<dd><p>Write the database to a text file.</p>
<p>Default mode is &#8216;w&#8217;. Use &#8216;a&#8217; to append to the file.
The header is written at the start of the database. Make sure to start
each line with a comment marker if you want to read it back!</p>
</dd></dl>

<dl class="method">
<dt id="flatkeydb.FlatDB.match">
<code class="descname">match</code><span class="sig-paren">(</span><em>key</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.FlatDB.match" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of records matching key=value.</p>
<p>This returns a list of primary keys of the matching records.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="functions-defined-in-module-flatkeydb">
<h2>87.2. Functions defined in module flatkeydb<a class="headerlink" href="#functions-defined-in-module-flatkeydb" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="flatkeydb.firstWord">
<code class="descclassname">flatkeydb.</code><code class="descname">firstWord</code><span class="sig-paren">(</span><em>s</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.firstWord" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the first word of a string.</p>
<p>Words are delimited by blanks. If the string does not contain a blank,
the whole string is returned.</p>
</dd></dl>

<dl class="function">
<dt id="flatkeydb.unQuote">
<code class="descclassname">flatkeydb.</code><code class="descname">unQuote</code><span class="sig-paren">(</span><em>s</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.unQuote" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove one level of quotes from a string.</p>
<p>If the string starts with a quote character (either single or double)
and ends with the SAME character, they are stripped of the string.</p>
</dd></dl>

<dl class="function">
<dt id="flatkeydb.splitKeyValue">
<code class="descclassname">flatkeydb.</code><code class="descname">splitKeyValue</code><span class="sig-paren">(</span><em>s</em>, <em>key_sep</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.splitKeyValue" title="Permalink to this definition">¶</a></dt>
<dd><p>Split a string in a (key,value) on occurrence of key_sep.</p>
<p>The string is split on the first occurrence of the substring key_sep.
Key and value are then stripped of leading and trailing whitespace.
If there is no key_sep, the whole string becomes the key and the
value is an empty string. If the string starts with key_sep,
the key becomes an empty string.</p>
</dd></dl>

<dl class="function">
<dt id="flatkeydb.ignore_error">
<code class="descclassname">flatkeydb.</code><code class="descname">ignore_error</code><span class="sig-paren">(</span><em>dummy</em><span class="sig-paren">)</span><a class="headerlink" href="#flatkeydb.ignore_error" title="Permalink to this definition">¶</a></dt>
<dd><p>This function can be used to override the default error handlers.</p>
<p>The effect will be to ignore the error (duplicate key, invalid record)
and to not add the affected data to the database.</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="sendmail.html" title="88. sendmail — sendmail.py: a simple program to send an email message"
             >next</a> |</li>
        <li class="right" >
          <a href="config.html" title="86. config — A general yet simple configuration class."
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyFormex 1.0.2-a6 documentation</a> &gt;</li>
          <li class="nav-item nav-item-1"><a href="../refman.html" >pyFormex reference manual</a> &gt;</li> 
      </ul>
    </div>
    <div class="footer">
    <span class="left">
        &copy; Copyright 2004-2015, Benedict Verhegghe.
    </span>
      Last updated on Sep 09, 2016.
    <span class="right">
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.5.
    </span>
    </div>
  </body>
</html>